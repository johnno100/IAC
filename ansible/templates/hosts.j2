# ansible/templates/hosts.j2
# Host file for Proxmox infrastructure
# Generated by Ansible on {{ ansible_date_time.date }}

127.0.0.1   localhost
::1         localhost ip6-localhost ip6-loopback
ff02::1     ip6-allnodes
ff02::2     ip6-allrouters

# Proxmox nodes
{% for host in groups['proxmox_hosts'] %}
{{ hostvars[host]['ansible_host'] }}    {{ host }}.{{ domain }}    {{ host }}
{% endfor %}

# VM hosts
{% if groups['vault_hosts'] is defined %}
{% for host in groups['vault_hosts'] %}
{{ hostvars[host]['ansible_host'] }}    {{ host }}.{{ domain }}    {{ host }}
{% endfor %}
{% endif %}

{% if groups['management_hosts'] is defined %}
{% for host in groups['management_hosts'] %}
{{ hostvars[host]['ansible_host'] }}    {{ host }}.{{ domain }}    {{ host }}
{% endfor %}
{% endif %}

{% if groups['docker_hosts'] is defined %}
{% for host in groups['docker_hosts'] %}
{{ hostvars[host]['ansible_host'] }}    {{ host }}.{{ domain }}    {{ host }}
{% endfor %}
{% endif %}

# Service hostnames
{% if vault_domain is defined %}
{{ hostvars[groups['vault_hosts'][0]]['ansible_host'] }}    {{ vault_domain }}
{% endif %}

{% if traefik_dashboard_domain is defined %}
{{ hostvars[groups['docker_hosts'][0]]['ansible_host'] }}    {{ traefik_dashboard_domain }}
{% endif %}

{% if authentik_domain is defined %}
{{ hostvars[groups['docker_hosts'][0]]['ansible_host'] }}    {{ authentik_domain }}
{% endif %}