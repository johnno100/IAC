# ansible/templates/storage-config.j2
# Proxmox storage configuration
# Generated by Ansible on {{ ansible_date_time.date }}

{% if item.type == 'lvmthin' %}
# LVM-Thin storage configuration
{{ item.name }}: {{ item.type }}
	thinpool {{ item.thinpool }}
	vgname {{ item.vgname }}
	content {{ item.content | default('images,rootdir') }}
{% if item.nodes is defined %}
	nodes {{ item.nodes | join(',') }}
{% endif %}
{% endif %}

{% if item.type == 'zfspool' %}
# ZFS Pool storage configuration
{{ item.name }}: {{ item.type }}
	pool {{ item.pool }}
	content {{ item.content | default('images,rootdir') }}
{% if item.nodes is defined %}
	nodes {{ item.nodes | join(',') }}
{% endif %}
{% if item.sparse is defined %}
	sparse {{ item.sparse | int }}
{% endif %}
{% endif %}

{% if item.type == 'dir' %}
# Directory storage configuration
{{ item.name }}: {{ item.type }}
	path {{ item.path }}
	content {{ item.content | default('images,rootdir,vztmpl,iso') }}
{% if item.nodes is defined %}
	nodes {{ item.nodes | join(',') }}
{% endif %}
{% if item.maxfiles is defined %}
	maxfiles {{ item.maxfiles }}
{% endif %}
{% endif %}

{% if item.type == 'nfs' %}
# NFS storage configuration
{{ item.name }}: {{ item.type }}
	server {{ item.server }}
	export {{ item.export }}
	content {{ item.content | default('images,rootdir') }}
{% if item.nodes is defined %}
	nodes {{ item.nodes | join(',') }}
{% endif %}
{% if item.options is defined %}
	options {{ item.options }}
{% endif %}
{% endif %}

{% if item.type == 'cephfs' %}
# CephFS storage configuration
{{ item.name }}: {{ item.type }}
	monhost {{ item.monhost | join(',') }}
	content {{ item.content | default('images,rootdir') }}
{% if item.nodes is defined %}
	nodes {{ item.nodes | join(',') }}
{% endif %}
{% if item.username is defined %}
	username {{ item.username }}
{% endif %}
{% if item.path is defined %}
	path {{ item.path }}
{% endif %}
{% endif %}

{% if item.type == 'rbd' %}
# Ceph RBD storage configuration
{{ item.name }}: {{ item.type }}
	monhost {{ item.monhost | join(',') }}
	pool {{ item.pool }}
	content {{ item.content | default('images') }}
{% if item.nodes is defined %}
	nodes {{ item.nodes | join(',') }}
{% endif %}
{% if item.username is defined %}
	username {{ item.username }}
{% endif %}
{% if item.krbd is defined %}
	krbd {{ item.krbd | int }}
{% endif %}
{% endif %}