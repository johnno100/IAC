# ansible/templates/chrony.conf.j2
# Chrony NTP configuration for Proxmox servers
# Generated by Ansible on {{ ansible_date_time.date }}

# Use public NTP servers from the pool.ntp.org project
{% for server in ntp_servers | default(['0.pool.ntp.org', '1.pool.ntp.org', '2.pool.ntp.org', '3.pool.ntp.org']) %}
server {{ server }} iburst
{% endfor %}

# Record the rate at which the system clock gains/losses time
driftfile /var/lib/chrony/drift

# Allow the system clock to be stepped in the first three updates
# if its offset is larger than 1 second
makestep 1.0 3

# Enable kernel synchronization of the real-time clock (RTC)
rtcsync

# Enable hardware timestamping on all interfaces that support it
#hwtimestamp *

# Increase the minimum number of selectable sources required to adjust
# the system clock
#minsources 2

# Allow NTP client access from local network
{% if allow_ntp_from is defined %}
{% for network in allow_ntp_from %}
allow {{ network }}
{% endfor %}
{% else %}
# No specific networks allowed, using defaults
{% endif %}

# Serve time even if not synchronized to a time source
#local stratum 10

# Specify directory for log files
logdir /var/log/chrony

# Select which information is logged
#log measurements statistics tracking

# Security settings
cmdport 0

# HIPAA/GDPR compliance settings
logchange 0.5